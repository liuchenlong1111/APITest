/* empty css             */import{p as A,a as Ve,v as be,m as se,E as oe}from"./api-6da0f383.js";/* empty css                 *//* empty css                  */import{b as je,E as ke,a as Ce}from"./el-dropdown-item-f5812d6d.js";import{d as Me,c as Ee,r as m,k as z,R as De,e as v,g as t,f as s,w as o,t as p,j as H,h as r,X as ae,F as le,at as de,a as $e,u as Pe,E as c,o as _,i as f,aA as Fe,au as Ae,av as ne,ay as ie,M as Ie,ah as Re,az as Ue,l as Be,A as he,W as Te}from"./index-7a753478.js";import{E as qe,_ as Le}from"./_plugin-vue_export-helper-4445a987.js";import{a as Ne,b as Se,c as ze,E as He}from"./index-a6bfc29c.js";import"./refs-08e124bd.js";import"./index-01aab8da.js";import"./event-9519ab40.js";const Oe={class:"project-detail-page"},We={class:"page-header"},Xe={class:"header-left"},Ge={class:"project-title"},Je={class:"project-desc"},Ke={class:"header-actions"},Qe={key:0,class:"stats-grid"},Ye={class:"stat-card"},Ze={class:"stat-content"},et={class:"stat-value"},tt={class:"stat-card"},st={class:"stat-content"},ot={class:"stat-value"},at={class:"stat-card"},lt={class:"stat-content"},dt={class:"stat-value"},nt={class:"stat-card"},it={class:"stat-content"},rt={class:"stat-value"},ut={class:"modules-section"},mt={class:"section-title"},pt={key:0,class:"count"},ct={class:"modules-grid"},vt=["onClick"],_t={class:"module-header"},ft={class:"module-info"},yt={class:"module-name"},wt={class:"module-desc"},gt={class:"module-stats"},xt={class:"stat-item"},Vt={class:"stat-text"},bt={class:"stat-item"},jt={class:"stat-text"},kt={key:0,class:"empty-state"},Ct={class:"apis-section"},Mt={class:"section-title"},Et={class:"apis-preview"},Dt={class:"api-summary-cards"},$t={class:"summary-card"},Pt={class:"method-stats"},Ft={class:"method-count"},At={class:"summary-card"},It={class:"status-stats"},Rt={class:"status-item"},Ut={class:"status-text"},Bt={class:"status-item"},ht={class:"status-text"},Tt=Me({__name:"Detail",setup(qt){const re=$e(),I=Pe(),y=Ee(()=>parseInt(re.params.id)),$=m(!1),R=m(!1),U=m(!1),B=m(!1),h=m(!1),u=m(null),k=m(!1),M=m(!1),E=m(!1),T=m(null),O=m({}),W=m(0),X=m(0),P=m(),q=m(),L=m(),w=z({name:"",description:"",project_id:0}),g=z({name:"",description:""}),x=z({name:"",description:""}),G={name:[{required:!0,message:"请输入模块名称",trigger:"blur"},{min:1,max:100,message:"模块名称长度在 1 到 100 个字符",trigger:"blur"}]},ue={name:[{required:!0,message:"请输入项目名称",trigger:"blur"},{min:1,max:100,message:"项目名称长度在 1 到 100 个字符",trigger:"blur"}]},D=async()=>{try{$.value=!0;const n=await A.getProject(y.value);u.value=n.data}catch(n){console.error("获取项目详情失败:",n),c.error("获取项目详情失败")}finally{$.value=!1}},me=async()=>{try{R.value=!0;const e=(await Ve.getAPIs({limit:1e3})).data,d={};let l=0,i=0;e.forEach(V=>{const b=V.method.toUpperCase();d[b]=(d[b]||0)+1,V.is_active!==!1?l++:i++}),O.value=d,W.value=l,X.value=i}catch(n){console.error("获取接口统计失败:",n)}finally{R.value=!1}},pe=async()=>{var e,d,l;if(!(!P.value||!await P.value.validate()))try{U.value=!0,w.project_id=y.value,await A.createModule(y.value,w),c.success("模块创建成功"),k.value=!1,Object.assign(w,{name:"",description:"",project_id:0}),(e=P.value)==null||e.resetFields(),await D()}catch(i){console.error("创建模块失败:",i),c.error(((l=(d=i.response)==null?void 0:d.data)==null?void 0:l.detail)||"创建模块失败")}finally{U.value=!1}},ce=async()=>{var e,d;if(!(!q.value||!T.value||!await q.value.validate()))try{B.value=!0,await se.updateModule(T.value,g),c.success("模块更新成功"),M.value=!1,await D()}catch(l){console.error("更新模块失败:",l),c.error(((d=(e=l.response)==null?void 0:e.data)==null?void 0:d.detail)||"更新模块失败")}finally{B.value=!1}},ve=async(n,e)=>{var d,l;try{await oe.confirm(`确定要删除模块"${e}"吗？删除后将无法恢复，包括其下的所有分类和接口！`,"⚠️ 删除确认",{confirmButtonText:"确定删除",cancelButtonText:"取消",type:"warning"}),await se.deleteModule(n),c.success("模块删除成功"),await D()}catch(i){i!=="cancel"&&(console.error("删除模块失败:",i),c.error(((l=(d=i.response)==null?void 0:d.data)==null?void 0:l.detail)||"删除模块失败"))}},_e=async()=>{var e,d;if(!(!L.value||!await L.value.validate()))try{h.value=!0,await A.updateProject(y.value,x),c.success("项目更新成功"),E.value=!1,await D()}catch(l){console.error("更新项目失败:",l),c.error(((d=(e=l.response)==null?void 0:e.data)==null?void 0:d.detail)||"更新项目失败")}finally{h.value=!1}},fe=async()=>{var n,e,d;try{await oe.confirm(`确定要删除项目"${(n=u.value)==null?void 0:n.name}"吗？删除后将无法恢复，包括其下的所有模块、分类和接口！`,"⚠️ 删除确认",{confirmButtonText:"确定删除",cancelButtonText:"取消",type:"warning"}),await A.deleteProject(y.value),c.success("项目删除成功"),I.push("/projects")}catch(l){l!=="cancel"&&(console.error("删除项目失败:",l),c.error(((d=(e=l.response)==null?void 0:e.data)==null?void 0:d.detail)||"删除项目失败"))}},ye=n=>{var e,d;n==="edit"?(x.name=((e=u.value)==null?void 0:e.name)||"",x.description=((d=u.value)==null?void 0:d.description)||"",E.value=!0):n==="delete"&&fe()},we=n=>{var V,b;const[e,d]=n.split("-"),l=parseInt(d),i=(b=(V=u.value)==null?void 0:V.modules)==null?void 0:b.find(j=>j.id===l);i&&(e==="edit"?(T.value=l,g.name=i.name,g.description=i.description||"",M.value=!0):e==="delete"?ve(l,i.name):e==="apis"&&I.push({path:"/apis",query:{project_id:y.value,module_id:l}}))},ge=n=>{I.push({path:"/apis",query:{project_id:y.value,module_id:n}})},xe=n=>new Date(n).toLocaleDateString("zh-CN",{year:"numeric",month:"numeric",day:"numeric"});return De(async()=>{await D(),await me()}),(n,e)=>{var K,Q,Y,Z,ee,te;const d=Te,l=qe,i=ke,V=Ce,b=je,j=Se,C=ze,N=He,S=Ne,J=be;return _(),v("div",Oe,[t("div",We,[t("div",Xe,[s(l,{type:"text",class:"back-btn",onClick:e[0]||(e[0]=a=>n.$router.go(-1))},{default:o(()=>[s(d,null,{default:o(()=>[s(f(Fe))]),_:1}),e[17]||(e[17]=r(" 返回 "))]),_:1,__:[17]}),t("div",Ge,[t("h1",null,p(((K=u.value)==null?void 0:K.name)||"项目详情"),1),t("p",Je,p(((Q=u.value)==null?void 0:Q.description)||"暂无描述"),1)])]),t("div",Ke,[s(l,{type:"primary",onClick:e[1]||(e[1]=a=>k.value=!0)},{default:o(()=>[s(d,null,{default:o(()=>[s(f(Ae))]),_:1}),e[18]||(e[18]=r(" 新建模块 "))]),_:1,__:[18]}),s(b,{onCommand:ye},{dropdown:o(()=>[s(V,null,{default:o(()=>[s(i,{command:"edit"},{default:o(()=>[s(d,null,{default:o(()=>[s(f(ne))]),_:1}),e[20]||(e[20]=r(" 编辑项目 "))]),_:1,__:[20]}),s(i,{command:"delete",divided:"",class:"danger-item"},{default:o(()=>[s(d,null,{default:o(()=>[s(f(ie))]),_:1}),e[21]||(e[21]=r(" 删除项目 "))]),_:1,__:[21]})]),_:1})]),default:o(()=>[s(l,{type:"default"},{default:o(()=>[e[19]||(e[19]=r(" 项目操作 ")),s(d,{class:"ml-1"},{default:o(()=>[s(f(Ie))]),_:1})]),_:1,__:[19]})]),_:1})])]),u.value?(_(),v("div",Qe,[t("div",Ye,[e[23]||(e[23]=t("div",{class:"stat-icon"},"🔧",-1)),t("div",Ze,[t("div",et,p(u.value.module_count),1),e[22]||(e[22]=t("div",{class:"stat-label"},"模块数量",-1))])]),t("div",tt,[e[25]||(e[25]=t("div",{class:"stat-icon"},"📂",-1)),t("div",st,[t("div",ot,p(u.value.category_count),1),e[24]||(e[24]=t("div",{class:"stat-label"},"分类数量",-1))])]),t("div",at,[e[27]||(e[27]=t("div",{class:"stat-icon"},"🔗",-1)),t("div",lt,[t("div",dt,p(u.value.api_count),1),e[26]||(e[26]=t("div",{class:"stat-label"},"接口数量",-1))])]),t("div",nt,[e[29]||(e[29]=t("div",{class:"stat-icon"},"📅",-1)),t("div",it,[t("div",rt,p(xe(u.value.created_at)),1),e[28]||(e[28]=t("div",{class:"stat-label"},"创建时间",-1))])])])):H("",!0),t("div",ut,[t("div",mt,[e[30]||(e[30]=t("span",{class:"icon"},"🔧",-1)),e[31]||(e[31]=r(" 项目模块 ")),u.value?(_(),v("span",pt,"("+p(((Y=u.value.modules)==null?void 0:Y.length)||0)+")",1)):H("",!0)]),ae((_(),v("div",ct,[(_(!0),v(le,null,de((Z=u.value)==null?void 0:Z.modules,a=>(_(),v("div",{key:a.id,class:"module-card",onClick:F=>ge(a.id)},[t("div",_t,[t("div",ft,[t("h3",yt,p(a.name),1),t("p",wt,p(a.description||"暂无描述"),1)]),s(b,{onCommand:we,onClick:e[2]||(e[2]=Be(()=>{},["stop"]))},{dropdown:o(()=>[s(V,null,{default:o(()=>[s(i,{command:`edit-${a.id}`},{default:o(()=>[s(d,null,{default:o(()=>[s(f(ne))]),_:1}),e[32]||(e[32]=r(" 编辑模块 "))]),_:2,__:[32]},1032,["command"]),s(i,{command:`apis-${a.id}`},{default:o(()=>[s(d,null,{default:o(()=>[s(f(Re))]),_:1}),e[33]||(e[33]=r(" 管理接口 "))]),_:2,__:[33]},1032,["command"]),s(i,{command:`delete-${a.id}`,divided:"",class:"danger-item"},{default:o(()=>[s(d,null,{default:o(()=>[s(f(ie))]),_:1}),e[34]||(e[34]=r(" 删除模块 "))]),_:2,__:[34]},1032,["command"])]),_:2},1024)]),default:o(()=>[s(d,{class:"more-icon"},{default:o(()=>[s(f(Ue))]),_:1})]),_:2},1024)]),t("div",gt,[t("div",xt,[e[35]||(e[35]=t("span",{class:"stat-icon"},"📂",-1)),t("span",Vt,p(a.category_count)+" 个分类",1)]),t("div",bt,[e[36]||(e[36]=t("span",{class:"stat-icon"},"🔗",-1)),t("span",jt,p(a.api_count)+" 个接口",1)])])],8,vt))),128)),((te=(ee=u.value)==null?void 0:ee.modules)==null?void 0:te.length)===0&&!$.value?(_(),v("div",kt,[e[38]||(e[38]=t("div",{class:"empty-icon"},"🔧",-1)),e[39]||(e[39]=t("div",{class:"empty-title"},"还没有模块",-1)),e[40]||(e[40]=t("div",{class:"empty-desc"},"创建模块来组织您的API接口",-1)),s(l,{type:"primary",onClick:e[3]||(e[3]=a=>k.value=!0)},{default:o(()=>e[37]||(e[37]=[r(" 创建模块 ")])),_:1,__:[37]})])):H("",!0)])),[[J,$.value]])]),t("div",Ct,[t("div",Mt,[e[42]||(e[42]=t("span",{class:"icon"},"🔗",-1)),e[43]||(e[43]=r(" 接口概览 ")),s(l,{type:"text",onClick:e[4]||(e[4]=a=>n.$router.push({path:"/apis",query:{project_id:y.value}})),class:"view-all-btn"},{default:o(()=>e[41]||(e[41]=[r(" 查看全部 → ")])),_:1,__:[41]})]),ae((_(),v("div",Et,[t("div",Dt,[t("div",$t,[e[44]||(e[44]=t("div",{class:"summary-title"},"HTTP 方法分布",-1)),t("div",Pt,[(_(!0),v(le,null,de(O.value,(a,F)=>(_(),v("div",{class:"method-item",key:F},[t("span",{class:he(["method-tag",`method-${F.toLowerCase()}`])},p(F),3),t("span",Ft,p(a),1)]))),128))])]),t("div",At,[e[47]||(e[47]=t("div",{class:"summary-title"},"接口状态分布",-1)),t("div",It,[t("div",Rt,[e[45]||(e[45]=t("span",{class:"status-dot active"},null,-1)),t("span",Ut,"活跃接口："+p(W.value),1)]),t("div",Bt,[e[46]||(e[46]=t("span",{class:"status-dot inactive"},null,-1)),t("span",ht,"待开发："+p(X.value),1)])])])])])),[[J,R.value]])]),s(S,{modelValue:k.value,"onUpdate:modelValue":e[8]||(e[8]=a=>k.value=a),title:"🔧 新建模块",width:"500px"},{footer:o(()=>[s(l,{onClick:e[7]||(e[7]=a=>k.value=!1)},{default:o(()=>e[48]||(e[48]=[r("取消")])),_:1,__:[48]}),s(l,{type:"primary",onClick:pe,loading:U.value},{default:o(()=>e[49]||(e[49]=[r(" 创建模块 ")])),_:1,__:[49]},8,["loading"])]),default:o(()=>[s(N,{model:w,rules:G,ref_key:"moduleFormRef",ref:P,"label-width":"80px"},{default:o(()=>[s(C,{label:"模块名称",prop:"name"},{default:o(()=>[s(j,{modelValue:w.name,"onUpdate:modelValue":e[5]||(e[5]=a=>w.name=a),placeholder:"请输入模块名称",maxlength:"100","show-word-limit":""},null,8,["modelValue"])]),_:1}),s(C,{label:"模块描述",prop:"description"},{default:o(()=>[s(j,{modelValue:w.description,"onUpdate:modelValue":e[6]||(e[6]=a=>w.description=a),type:"textarea",rows:4,placeholder:"请输入模块描述（可选）",maxlength:"500","show-word-limit":""},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),s(S,{modelValue:M.value,"onUpdate:modelValue":e[12]||(e[12]=a=>M.value=a),title:"✏️ 编辑模块",width:"500px"},{footer:o(()=>[s(l,{onClick:e[11]||(e[11]=a=>M.value=!1)},{default:o(()=>e[50]||(e[50]=[r("取消")])),_:1,__:[50]}),s(l,{type:"primary",onClick:ce,loading:B.value},{default:o(()=>e[51]||(e[51]=[r(" 保存更改 ")])),_:1,__:[51]},8,["loading"])]),default:o(()=>[s(N,{model:g,rules:G,ref_key:"editModuleFormRef",ref:q,"label-width":"80px"},{default:o(()=>[s(C,{label:"模块名称",prop:"name"},{default:o(()=>[s(j,{modelValue:g.name,"onUpdate:modelValue":e[9]||(e[9]=a=>g.name=a),placeholder:"请输入模块名称",maxlength:"100","show-word-limit":""},null,8,["modelValue"])]),_:1}),s(C,{label:"模块描述",prop:"description"},{default:o(()=>[s(j,{modelValue:g.description,"onUpdate:modelValue":e[10]||(e[10]=a=>g.description=a),type:"textarea",rows:4,placeholder:"请输入模块描述（可选）",maxlength:"500","show-word-limit":""},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),s(S,{modelValue:E.value,"onUpdate:modelValue":e[16]||(e[16]=a=>E.value=a),title:"✏️ 编辑项目",width:"500px"},{footer:o(()=>[s(l,{onClick:e[15]||(e[15]=a=>E.value=!1)},{default:o(()=>e[52]||(e[52]=[r("取消")])),_:1,__:[52]}),s(l,{type:"primary",onClick:_e,loading:h.value},{default:o(()=>e[53]||(e[53]=[r(" 保存更改 ")])),_:1,__:[53]},8,["loading"])]),default:o(()=>[s(N,{model:x,rules:ue,ref_key:"editProjectFormRef",ref:L,"label-width":"80px"},{default:o(()=>[s(C,{label:"项目名称",prop:"name"},{default:o(()=>[s(j,{modelValue:x.name,"onUpdate:modelValue":e[13]||(e[13]=a=>x.name=a),placeholder:"请输入项目名称",maxlength:"100","show-word-limit":""},null,8,["modelValue"])]),_:1}),s(C,{label:"项目描述",prop:"description"},{default:o(()=>[s(j,{modelValue:x.description,"onUpdate:modelValue":e[14]||(e[14]=a=>x.description=a),type:"textarea",rows:4,placeholder:"请输入项目描述（可选）",maxlength:"500","show-word-limit":""},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}});const Qt=Le(Tt,[["__scopeId","data-v-bf2c468b"]]);export{Qt as default};
